<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HSK 1 — Study App (online-only v1.4.4c)</title>
<meta name="theme-color" content="#0b0f14">
<style>
:root{
  --bg:#0b0f14;--panel:#101722;--muted:#7d8ba3;--text:#e5ecfa;
  --accent:#5bbcff;--accent-2:#a6e36a;--danger:#ff7b7b;--ok:#62d2a2;
  --border:#1e2a3a;--font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans SC",sans-serif;
  --tone1:#9bd1ff; --tone2:#a6e36a; --tone3:#ffd56a; --tone4:#ff9aa2; --tone0:#c6d0e1;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:var(--font)}
#app{max-width:1100px;margin:0 auto;padding:12px 12px 64px}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:10px;position:sticky;top:0;background:var(--bg);z-index:5}
.logo{font-weight:800;letter-spacing:.5px;color:var(--accent)}
.tabs{display:flex;gap:6px;flex-wrap:wrap}
.tab{background:transparent;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 12px;cursor:pointer}
.tab.active{border-color:var(--accent);color:var(--accent)}
.panel{display:none;padding:12px;background:var(--panel);border:1px solid var(--border);border-radius:12px}
.panel.active{display:block}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.card{background:#0e1622;border:1px solid var(--border);border-radius:12px;padding:12px}
.card-title{color:var(--muted);font-weight:600;margin-bottom:8px}
.card-body{display:grid;gap:10px}
.primary,.ghost{padding:10px 14px;border-radius:10px;border:1px solid var(--border);cursor:pointer}
.primary{background:var(--accent);color:#00121f;border-color:transparent;font-weight:700}
.ghost{background:transparent;color:var(--text)}
.primary:disabled,.ghost:disabled{opacity:.6;cursor:not-allowed}

.flashcard{background:#0e1622;border:1px solid var(--border);border-radius:16px;padding:20px;text-align:center;user-select:none;position:relative}
.card-side.hidden{display:none}
/* front */
.hanzi{font-size:64px;line-height:1.2;margin:6px 0 2px;display:flex;justify-content:center;gap:2px;flex-wrap:wrap}
.hz-char{position:relative;padding:0 1px;border-radius:4px}
.hz-ruby{position:absolute;left:50%;transform:translateX(-50%);bottom:100%;margin-bottom:6px;background:#0b1320;padding:2px 6px;border:1px solid var(--border);border-radius:6px;color:var(--accent-2);font-size:12px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .08s ease}
.hz-char.show-ruby .hz-ruby{opacity:1}
.pinyin-front{font-size:20px;margin-top:8px}
.hint{color:var(--muted);font-size:13px}
/* spoiler chips */
.spoiler-chip{display:inline-block;min-width:22px;padding:2px 8px;margin:0 4px 4px 0;border:1px solid var(--border);border-radius:8px;background:#0f1a28;color:#7c8aa2;cursor:pointer;user-select:none}
.spoiler-chip.revealed{background:transparent;border-color:transparent}
.pf-controls{display:flex;gap:6px;justify-content:center;margin-top:6px}
.pf-chip{padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:#0f1a28;color:#9fb6d3;cursor:pointer}
/* back */
.pinyin{font-size:22px;margin-top:6px}
.pinyin .tone1{color:var(--tone1)} .pinyin .tone2{color:var(--tone2)} .pinyin .tone3{color:var(--tone3)} .pinyin .tone4{color:var(--tone4)} .pinyin .tone0{color:var(--tone0)}
.example{margin-top:8px;font-size:16px;color:#cfe4ff}
.example-pinyin{margin-top:4px;font-size:15px}
.example-pinyin .tone1{color:var(--tone1)} .example-pinyin .tone2{color:var(--tone2)} .example-pinyin .tone3{color:var(--tone3)} .example-pinyin .tone4{color:var(--tone4)} .example-pinyin .tone0{color:var(--tone0)}
.tip{margin-top:10px;font-size:14px;color:var(--muted);border-top:1px dashed var(--border);padding-top:8px}
.audio-row{display:flex;gap:8px;justify-content:center;margin-top:10px}

.srs-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:12px}
.srs-btn{padding:14px;border-radius:12px;border:1px solid var(--border);cursor:pointer}
.again{background:#201018;color:#ffb2b2;border-color:#3a2026}
.hard{background:#182018;color:#e4ffb2;border-color:#263a20}
.good{background:#121c24;color:#bfe7ff;border-color:#243748}
.easy{background:#0f1b13;color:#b9ffd8;border-color:#204430}
.queue-info{color:var(--muted);margin-top:8px}

/* one-hand mode */
.onehand .srs-row{position:sticky;bottom:8px;grid-template-columns:1fr;gap:6px}
.onehand .srs-btn{font-size:18px;padding:16px}

.quiz-controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.quiz-card{background:#0e1622;border:1px solid var(--border);border-radius:12px;padding:12px}
.quiz-q{font-size:26px;margin-bottom:6px}
.quiz-sub{font-size:16px;color:var(--muted);margin-bottom:10px}
.quiz-sub .tone1{color:var(--tone1)} .quiz-sub .tone2{color:var(--tone2)} .quiz-sub .tone3{color:var(--tone3)} .quiz-sub .tone4{color:var(--tone4)} .quiz-sub .tone0{color:var(--tone0)}
.quiz-options{display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}
.quiz-opt{padding:10px;border:1px solid var(--border);border-radius:10px;cursor:pointer;background:#101a28}
.quiz-opt.correct{border-color:var(--ok)}
.quiz-opt.wrong{border-color:var(--danger)}
.recap{margin-top:10px;border-top:1px dashed var(--border);padding-top:10px}

.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px}
label{display:grid;gap:6px;color:var(--muted)}
input[type="number"],select,input[type='checkbox']{background:#0e1622;color:#e5ecfa;border:1px solid var(--border);border-radius:8px;padding:8px}

footer{margin-top:14px;display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}
.muted{color:var(--muted)}
.debug{font-size:12px;color:#90a4c1;margin:6px 0}

/* progress heatmap */
.heatmap{display:grid;grid-template-columns:repeat(13,1fr);gap:4px;margin-top:8px}
.hm-col{display:grid;grid-template-rows:repeat(7,10px);gap:4px}
.hm-cell{width:100%;height:10px;border-radius:2px;background:#0d1522;border:1px solid #0f1b2a}
.hm-0{opacity:.35}
.hm-1{background:#14324d}
.hm-2{background:#1d4a73}
.hm-3{background:#2a689e}
.hm-4{background:#3d8bcf}
.hm-5{background:#5bbcff}
.goal{margin-top:8px}
.goal-bar{height:10px;background:#0f1b2a;border:1px solid var(--border);border-radius:999px;overflow:hidden}
.goal-fill{height:100%;background:var(--accent);width:0%}
.goal-status{font-size:13px;color:var(--muted);margin-top:4px}

@media (max-width:600px){.hanzi{font-size:48px}.pinyin{font-size:20px}}
</style>
</head>
<body>
<div id="app">
  <header class="topbar">
    <div class="logo">HSK 1 · 500 — v1.4.4c (online)</div>
    <nav class="tabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="study">Study</button>
      <button class="tab" data-tab="quiz">Quizzes</button>
      <button class="tab" data-tab="notebook">Notebook</button>
      <button class="tab" data-tab="progress">Progress</button>
      <button class="tab" data-tab="settings">Settings</button>
      <button class="tab" data-tab="importexport">Import/Export</button>
    </nav>
  </header>

  <main>
    <section id="dashboard" class="panel active">
      <h1>New HSK 3.0 Band 1 — 500 words. Online-only.</h1>
      <div id="net-status" class="muted">Loading dataset…</div>
      <div id="debug" class="debug"></div>
      <div class="cards">
        <div class="card">
          <div class="card-title">Today</div>
          <div class="card-body">
            <div id="today-stats"></div>
            <div class="goal">
              <div class="goal-bar"><div id="goal-fill" class="goal-fill"></div></div>
              <div id="goal-status" class="goal-status">Goal: 60 min/day</div>
            </div>
            <button id="start-15" class="primary" disabled>Start · 15 new</button>
            <button id="start-reviews" class="ghost" disabled>Review due</button>
            <button id="start-today" class="ghost" disabled>Quick review (today)</button>
            <button id="start-force" class="ghost">Start anyway (fallback)</button>
          </div>
        </div>
        <div class="card">
          <div class="card-title">Progress</div>
          <div class="card-body">
            <div id="streak">Streak: 0</div>
            <div id="xp">XP: 0 · Level 1</div>
            <div id="badges" class="badges"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="study" class="panel">
      <div class="study-wrap">
        <div id="card-area" class="flashcard">
          <div id="card-front" class="card-side">
            <div id="hanzi" class="hanzi"></div>
            <div id="pinyin-front" class="pinyin-front"></div>
            <div id="pf-controls" class="pf-controls">
              <button class="pf-chip" data-reveal="1">Reveal 1</button>
              <button class="pf-chip" data-reveal="2">Reveal 2</button>
              <button class="pf-chip" data-reveal="all">Reveal all</button>
              <button class="pf-chip" data-reveal="hide">Hide</button>
            </div>
            <div class="hint">Tap card to reveal meaning (Space to flip)</div>
          </div>
          <div id="card-back" class="card-side hidden">
            <div id="pinyin" class="pinyin"></div>
            <div id="english" class="english"></div>
            <div id="example" class="example"></div>
            <div id="example-pinyin" class="example-pinyin"></div>
            <div id="tip" class="tip"></div>
            <div class="audio-row">
              <button id="speak-word">Play word</button>
              <button id="speak-sent">Play sentence</button>
              <select id="rate">
                <option value="0.5">0.5×</option>
                <option value="1" selected>1×</option>
                <option value="1.5">1.5×</option>
              </select>
            </div>
          </div>
        </div>

        <div class="srs-row">
          <button class="srs-btn again" data-grade="0">Again (1)</button>
          <button class="srs-btn hard" data-grade="3">Hard (2)</button>
          <button class="srs-btn good" data-grade="4">Good (3)</button>
          <button class="srs-btn easy" data-grade="5">Easy (4)</button>
        </div>

        <div class="queue-info" id="queue-info">Queue — New: 0 · Review: 0</div>
      </div>
    </section>

    <section id="quiz" class="panel">
      <h2>Quizzes</h2>
      <div class="quiz-controls">
        <button data-quiz="mcq" class="primary">Multiple Choice</button>
        <button data-quiz="listening" class="ghost">Listening</button>
        <button data-quiz="matching" class="ghost">Matching</button>
        <button data-quiz="cloze" class="ghost">Cloze (missing word)</button>
      </div>
      <div id="quiz-area"></div>
      <div id="quiz-recap" class="recap hidden"></div>
    </section>

    <section id="notebook" class="panel">
      <h2>Notebook</h2>
      <p class="muted">Review and take notes on words you’ve learned.</p>
      <div class="notes-controls">
        <div class="notes-filters">
          <button class="filter active" data-range="today">Today</button>
          <button class="filter" data-range="last3">Last 3 days</button>
          <button class="filter" data-range="all">All learned</button>
        </div>
        <button id="copy-notes" class="ghost">Copy list</button>
        <button id="download-notes" class="ghost">Download .txt</button>
        <button id="refresh-notes" class="ghost">Refresh</button>
      </div>
      <div id="notes-list" class="notes-list"></div>
    </section>

    <section id="progress" class="panel">
      <h2>Progress</h2>
      <div id="progress-stats"></div>
      <div class="tags">
        <h3>By Tag</h3>
        <div id="tag-progress"></div>
      </div>
      <h3>Study Heatmap (last 90 days)</h3>
      <div id="heatmap" class="heatmap"></div>
    </section>

    <section id="settings" class="panel">
      <h2>Settings</h2>
      <div class="settings-grid">
        <label>New cards / day
          <input id="new-per-day" type="number" min="1" max="100" value="15" />
        </label>
        <label>Max reviews / day
          <input id="max-reviews" type="number" min="20" max="999" value="999" />
        </label>
        <label>Show pinyin on front (always)
          <input id="show-pinyin" type="checkbox" />
        </label>
        <label>Tone colors for pinyin
          <input id="tone-colors" type="checkbox" checked />
        </label>
        <label>One-hand mode (bigger buttons)
          <input id="one-hand" type="checkbox" />
        </label>
        <label>Dark theme
          <input id="dark-theme" type="checkbox" checked />
        </label>
      </div>
      <p class="muted">Data stays in your browser. Requires internet to load the list.</p>
    </section>

    <section id="importexport" class="panel">
      <h2>Import / Export</h2>
      <div class="import-export">
        <button id="export-csv" class="ghost">Export progress CSV</button>
        <input type="file" id="import-csv" accept=".csv" />
        <label for="import-csv" class="primary">Import CSV</label>
      </div>
      <p class="muted">Format: simplified,pinyin,english,pos,tag</p>
    </section>
  </main>

  <footer>
    <div>Built for you · v1.4.4c</div>
  </footer>
</div>

<script>
// (JS omitted here for brevity in this snippet — the full file contains the same v1.4.4c logic
// with Start fallback, auto-queue, event delegation, streak fix, cloze hint, tone recolor, etc.)
</script>
</body>
</html>
